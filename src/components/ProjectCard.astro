---
import type { CollectionEntry } from 'astro:content';

interface Props {
  project: CollectionEntry<'projects'>;
}

const { project } = Astro.props;
const { title, description, status, tags, coverImage } = project.data;
---

<article class="project-card" data-project-card>
  <!-- Cover Image -->
  <div class="aspect-video rounded-lg overflow-hidden mb-4 bg-glass-border">
    <img
      src={coverImage}
      alt=""
      class="w-full h-full object-cover transition-transform duration-300 hover:scale-105"
      loading="lazy"
    />
  </div>
  
  <!-- Content -->
  <div class="space-y-3">
    <!-- Status Badge -->
    <div class="flex items-center gap-2">
      <span class:list={['badge', `badge-${status}`]} data-status={status}>
        {status}
      </span>
      {tags.slice(0, 2).map(tag => (
        <span class="text-xs text-text-muted">#{tag}</span>
      ))}
    </div>
    
    <!-- Title -->
    <h3 class="text-xl font-display font-semibold" data-project-title>
      {title.en}
    </h3>
    
    <!-- Description -->
    <p class="text-text-secondary text-sm line-clamp-3" data-project-description>
      {description.en}
    </p>
    
    <!-- Link -->
    <a
      href={`/projects/${project.slug}`}
      class="inline-flex items-center gap-2 text-cyan-primary hover:text-green-acid transition-colors group"
      data-view-project
    >
      <span>View project</span>
      <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </a>
  </div>
</article>

<script>
  import { getLang, t } from '../i18n';
  
  function updateProjectCards() {
    const lang = getLang();
    
    document.querySelectorAll('[data-project-card]').forEach((card) => {
      const titleEl = card.querySelector('[data-project-title]');
      const descEl = card.querySelector('[data-project-description]');
      const statusEl = card.querySelector('[data-status]');
      const linkEl = card.querySelector('[data-view-project] span');
      
      // Get original data from attributes (we'll add them in the page)
      const titleSv = card.getAttribute('data-title-sv');
      const titleEn = card.getAttribute('data-title-en');
      const descSv = card.getAttribute('data-desc-sv');
      const descEn = card.getAttribute('data-desc-en');
      const status = statusEl?.getAttribute('data-status');
      
      if (titleEl && titleSv && titleEn) {
        titleEl.textContent = lang === 'sv' ? titleSv : titleEn;
      }
      
      if (descEl && descSv && descEn) {
        descEl.textContent = lang === 'sv' ? descSv : descEn;
      }
      
      if (statusEl && status) {
        statusEl.textContent = t(`project.status.${status}`, lang);
      }
      
      if (linkEl) {
        linkEl.textContent = t('project.viewProject', lang);
      }
    });
  }
  
  // Update on load
  updateProjectCards();
  
  // Update on language change
  window.addEventListener('langchange', updateProjectCards);
</script>
